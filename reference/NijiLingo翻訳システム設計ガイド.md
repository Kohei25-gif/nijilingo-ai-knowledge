# NijiLingo ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ  å®Œå…¨è¨­è¨ˆã‚¬ã‚¤ãƒ‰

> ç†æƒ³ã¨ç¾å®Ÿã€ç ”ç©¶ã¨å®Ÿè£…ã®æ¶ã‘æ©‹

---

## ğŸ“‘ ç›®æ¬¡

1. [ç¾çŠ¶åˆ†æï¼šç†æƒ³ã¨ç¾å®Ÿ](#1-ç¾çŠ¶åˆ†æç†æƒ³ã¨ç¾å®Ÿ)
2. [æ—¥æœ¬èªâ†’è‹±èªç¿»è¨³ã®æ ¸å¿ƒèª²é¡Œ](#2-æ—¥æœ¬èªè‹±èªç¿»è¨³ã®æ ¸å¿ƒèª²é¡Œ)
3. [ç ”ç©¶ãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ](#3-ç ”ç©¶ãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ)
4. [ã‚³ãƒ¼ãƒ‰åˆ†æã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#4-ã‚³ãƒ¼ãƒ‰åˆ†æã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰)
5. [æ¤œè¨¼ã¨æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«](#5-æ¤œè¨¼ã¨æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«)

---

## 1. ç¾çŠ¶åˆ†æï¼šç†æƒ³ã¨ç¾å®Ÿ

### 1.1 ç†æƒ³ã®ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆNaniç¿»è¨³ã‚’å‚è€ƒï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã€ç†æƒ³ã®å‹•ä½œã€‘                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¥æœ¬èªã‚’å…¥åŠ›                               â”‚
â”‚ 2. 300mså¾Œã€å…¨ãƒˆãƒ¼ãƒ³ãƒ¬ãƒ™ãƒ«ï¼ˆ0/25/50/75/100ï¼‰ã‚’äº‹å‰ç”Ÿæˆ  â”‚
â”‚ 3. ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œæ™‚ã€å³æ™‚ï¼ˆ<10msï¼‰ã§ç¿»è¨³ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹    â”‚
â”‚ 4. æ—¥æœ¬èªï¼ˆé€†ç¿»è¨³ï¼‰ã¨è‹±èªï¼ˆç¿»è¨³ï¼‰ãŒå®Œå…¨ã«å¯¾å¿œ           â”‚
â”‚ 5. åè©èªè­˜ã€ä¸»èªçœç•¥ã€modality_classãŒæ­£ç¢º             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç¾å®Ÿã®å•é¡Œï¼ˆæ¤œè¨¼ã§ç™ºè¦‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã€ç¾å®Ÿã®èª²é¡Œã€‘                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ æœ€é‡è¦: æ“ä½œã—ãªã„ã¨ç¿»è¨³ãŒå¤‰ã‚ã‚‰ãªã„                  â”‚
â”‚    â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ãŒé–“ã«åˆã‚ãªã„                       â”‚
â”‚                                                         â”‚
â”‚ ğŸŸ¡ è¦æ¤œè¨: æ—¥æœ¬èªï¼ˆé€†ç¿»è¨³ï¼‰ã¯å¤‰ã‚ã‚‹ãŒè‹±èªï¼ˆç¿»è¨³ï¼‰ã¯åŒã˜  â”‚
â”‚    â†’ ç¿»è¨³ã¨é€†ç¿»è¨³ã®ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã¦ã„ã‚‹           â”‚
â”‚                                                         â”‚
â”‚ ğŸ”´ åè©èªè­˜ã‚¨ãƒ©ãƒ¼ï¼ˆã€ŒãŠã†ãŸã€â†’ã€Œsingingã€ï¼‰              â”‚
â”‚    â†’ å›ºæœ‰åè©ã¨ä¸€èˆ¬åè©ã®åŒºåˆ¥ãŒã§ãã¦ã„ãªã„             â”‚
â”‚                                                         â”‚
â”‚ ğŸ”´ ä¸»èªçœç•¥ã®èª¤è§£é‡ˆ                                      â”‚
â”‚    â†’ æ–‡è„ˆã‹ã‚‰ã®æ¨å®šãŒä¸ååˆ†                             â”‚
â”‚                                                         â”‚
â”‚ ğŸ”´ modality_classå¤‰æ›´ï¼ˆä¾é ¼â†’ç¢ºèªï¼‰                       â”‚
â”‚    â†’ PARTIALç·¨é›†ã§æ„å‘³ãŒå¤‰ã‚ã£ã¦ã—ã¾ã†                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¹æœ¬åŸå› ã®åˆ†æ

| å•é¡Œ | æ ¹æœ¬åŸå›  | å½±éŸ¿ç¯„å›² |
|------|----------|----------|
| ç¿»è¨³ãŒå¤‰ã‚ã‚‰ãªã„ | äº‹å‰ç”Ÿæˆå®Œäº†å‰ã«ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œ | UI/UX |
| æ—¥è‹±ä¹–é›¢ | ç¿»è¨³ã¨é€†ç¿»è¨³ãŒåˆ¥ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ç”Ÿæˆ | å“è³ª |
| åè©èª¤èªè­˜ | æ–‡è„ˆè§£æãªã—ã®å˜ç´”ãªç¿»è¨³ | æ­£ç¢ºæ€§ |
| ä¸»èªçœç•¥èª¤è§£ | ã‚¼ãƒ­ç…§å¿œè§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ãªã— | æ­£ç¢ºæ€§ |
| modalityå¤‰æ›´ | PARTIALç·¨é›†ã®åˆ¶ç´„ãŒç·©ã„ | å“è³ª |

---

## 2. æ—¥æœ¬èªâ†’è‹±èªç¿»è¨³ã®æ ¸å¿ƒèª²é¡Œ

### 2.1 èª²é¡Œ1ï¼šåè©èªè­˜å•é¡Œ

#### å•é¡Œã®å…·ä½“ä¾‹

```
ã€å…¥åŠ›ã€‘ãŠã†ãŸãŒå¯ã¦ã‹ã‚‰å‘ã‹ã„ã¾ã™ã€‚

ã€èª¤è¨³ã€‘"I'll go after singing sleeps."ï¼ˆãŠã†ãŸ=singingï¼‰
ã€æ­£è§£ã€‘"I'll head over after Ota goes to sleep."ï¼ˆãŠã†ãŸ=äººåOutaï¼‰
```

#### ãªãœé–“é•ãˆã‚‹ã®ã‹

| è¦å›  | èª¬æ˜ |
|------|------|
| ã²ã‚‰ãŒãªè¡¨è¨˜ | ã€ŒãŠã†ãŸã€ã¯ã€ŒãŠæ­Œï¼ˆsongï¼‰ã€ã¨ã‚‚èª­ã‚ã‚‹ |
| æ–‡è„ˆè§£æä¸è¶³ | å¾Œç¶šã®ã€Œå¯ã¦ã‹ã‚‰ã€ãŒäººé–“ã®å‹•ä½œã§ã‚ã‚‹ã“ã¨ã‚’ç„¡è¦– |
| NERæœªå®Ÿè£… | å›ºæœ‰åè©è­˜åˆ¥ï¼ˆNamed Entity Recognitionï¼‰ãŒãªã„ |

#### ç ”ç©¶çŸ¥è¦‹ï¼šåè©èªè­˜ã®ç²¾åº¦å‘ä¸Š

è«–æ–‡ [^7^] "CodeNER: Code Prompting for Named Entity Recognition" ã«ã‚ˆã‚‹ã¨ï¼š

> ã€Œã‚¿ã‚¹ã‚¯ã«ç‰¹åŒ–ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€LLMã®NERæ€§èƒ½ãŒå‘ä¸Šã™ã‚‹ã€

**é©ç”¨æ–¹æ³•**ï¼š
```
ç¿»è¨³å‰ã«ã€ãƒ†ã‚­ã‚¹ãƒˆå†…ã®åè©ã‚’ä»¥ä¸‹ã«åˆ†é¡ï¼š
1. äººåï¼ˆPersonï¼‰: å¾Œã‚ã«äººé–“ã®å‹•ä½œãŒç¶šã
2. çµ„ç¹”åï¼ˆOrganizationï¼‰: å›ºæœ‰åè©ï¼‹çµ„ç¹”ã‚’ç¤ºã™æ¥å°¾è¾
3. åœ°åï¼ˆLocationï¼‰: å ´æ‰€ã‚’ç¤ºã™æ–‡è„ˆ
4. ä¸€èˆ¬åè©ï¼ˆCommonï¼‰: ä¸Šè¨˜ä»¥å¤–
```

---

### 2.2 èª²é¡Œ2ï¼šä¸»èªçœç•¥ï¼ˆã‚¼ãƒ­ç…§å¿œï¼‰

#### å•é¡Œã®å…·ä½“ä¾‹

```
ã€å…¥åŠ›ã€‘æ˜æ—¥ä¼šè­°ã«è¡Œãã¾ã™ã€‚

ã€èª¤è¨³ã€‘"Tomorrow will go to the meeting."ï¼ˆä¸»èªãªã—ï¼‰
ã€æ­£è§£ã€‘"I will go to the meeting tomorrow." / "He will go..."ï¼ˆæ–‡è„ˆä¾å­˜ï¼‰
```

#### æ—¥æœ¬èªã®ç‰¹æ®Šæ€§

| è¨€èª | ä¸»èªã®æ‰±ã„ |
|------|-----------|
| æ—¥æœ¬èª | pro-dropè¨€èªï¼ˆçœç•¥å¯èƒ½ï¼‰ |
| è‹±èª | ä¸»èªå¿…é ˆ |

#### ç ”ç©¶çŸ¥è¦‹ï¼šã‚¼ãƒ­ç…§å¿œè§£æ±º

è«–æ–‡ [^11^] "Japanese Zero Anaphora Resolution using Machine Translation" ã«ã‚ˆã‚‹ã¨ï¼š

> ã€Œæ–‡è„ˆæƒ…å ±ï¼ˆå‰å¾Œã®æ–‡ã€æ•¬èªã€å‹•è©ã®æ„å‘³å±æ€§ï¼‰ã‹ã‚‰çœç•¥ä¸»èªã‚’æ¨å®šå¯èƒ½ã€

**æ¨å®šã®æ‰‹é †**ï¼š
```
1. å‹•è©ã®ç¨®é¡ã‹ã‚‰ä¸»èªã‚’æ¨å®š
   - æ¥ã‚‹ãƒ»è¡Œããƒ»å¸°ã‚‹ â†’ ç§»å‹•ã™ã‚‹ä¸»ä½“
   - é£Ÿã¹ã‚‹ãƒ»é£²ã‚€ â†’ æ‘‚å–ã™ã‚‹ä¸»ä½“
   - å¯ã‚‹ãƒ»èµ·ãã‚‹ â†’ ç”Ÿæ´»å‹•ä½œã®ä¸»ä½“

2. æ•¬èªæƒ…å ±ã‹ã‚‰ä¸»èªã‚’æ¨å®š
   - å°Šæ•¬èªï¼ˆã„ã‚‰ã£ã—ã‚ƒã‚‹ãƒ»ãŠã£ã—ã‚ƒã‚‹ï¼‰â†’ ç›¸æ‰‹ãŒä¸»èª
   - è¬™è­²èªï¼ˆä¼ºã†ãƒ»å‚ã‚‹ï¼‰â†’ è‡ªåˆ†ãŒä¸»èª

3. æ–‡æœ«ã®èªå°¾ã‹ã‚‰ä¸»èªã‚’æ¨å®š
   - ã€œã¦ãã ã•ã„ â†’ ç›¸æ‰‹ã«ä¾é ¼
   - ã€œãŸã„ â†’ è‡ªåˆ†ã®é¡˜æœ›
```

---

### 2.3 èª²é¡Œ3ï¼šmodality_classä¿æŒ

#### å•é¡Œã®å…·ä½“ä¾‹

```
ã€å…¥åŠ›ã€‘æ˜æ—¥ã®ä¼šè­°ã®è³‡æ–™ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿ

ã€èª¤è¨³ã€‘"Are you sending the materials for tomorrow's meeting?"ï¼ˆç¢ºèªï¼‰
ã€æ­£è§£ã€‘"Can you send me the materials for tomorrow's meeting?"ï¼ˆä¾é ¼ï¼‰
```

#### modality_classã®ç¨®é¡

| ã‚¯ãƒ©ã‚¹ | ä¾‹ | æ—¥æœ¬èªè¡¨ç¾ |
|--------|-----|-----------|
| ä¾é ¼ï¼ˆRequestï¼‰ | Can you...? | ã€œã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿ/ã€œã¦ãã‚Œã‚‹ï¼Ÿ |
| ç¢ºèªï¼ˆConfirmationï¼‰ | Are you...? | ã€œã—ã¦ã‚‹ï¼Ÿ/ã€œãªã®ï¼Ÿ |
| ææ¡ˆï¼ˆSuggestionï¼‰ | Shall we...? | ã€œã—ãªã„ï¼Ÿ/ã€œã©ã†ï¼Ÿ |
| ç¾©å‹™ï¼ˆObligationï¼‰ | You must... | ã€œã—ãªãã‚ƒ/ã€œã™ã¹ã |

#### ç ”ç©¶çŸ¥è¦‹ï¼šmodalityä¿æŒ

è«–æ–‡ [^2^] "Multi-Agent System for High-Quality Translation" ã«ã‚ˆã‚‹ã¨ï¼š

> ã€Œç¿»è¨³æ™‚ã«ç™ºè©±ã®æ„å›³ï¼ˆmodalityï¼‰ã‚’æ˜ç¤ºçš„ã«ã‚¿ã‚°ä»˜ã‘ã™ã‚‹ã“ã¨ã§ã€æ„å›³ã®ä¿æŒç‡ãŒå‘ä¸Šã€

---

## 3. ç ”ç©¶ãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

### 3.1 åŸºæœ¬ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹é€ 

```
ã€ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€‘

ã‚ãªãŸã¯æ—¥æœ¬èªã‹ã‚‰è‹±èªã¸ã®ç¿»è¨³å°‚é–€å®¶ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ç¿»è¨³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

ã€ã‚¹ãƒ†ãƒƒãƒ—1: åè©è­˜åˆ¥ï¼ˆNERï¼‰ã€‘
ãƒ†ã‚­ã‚¹ãƒˆå†…ã®åè©ã‚’åˆ†é¡ï¼š
- äººå: å¾Œã‚ã«äººé–“ã®å‹•ä½œï¼ˆå¯ã‚‹ã€æ¥ã‚‹ã€é£Ÿã¹ã‚‹ç­‰ï¼‰ãŒç¶šã
- çµ„ç¹”å: å›ºæœ‰åè©ï¼‹çµ„ç¹”ã‚’ç¤ºã™æ¥å°¾è¾
- åœ°å: å ´æ‰€ã‚’ç¤ºã™æ–‡è„ˆ
- ä¸€èˆ¬åè©: ä¸Šè¨˜ä»¥å¤–

ã€ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¼ãƒ­ç…§å¿œè§£æ±ºã€‘
çœç•¥ã•ã‚Œã¦ã„ã‚‹ä¸»èªã‚’æ–‡è„ˆã‹ã‚‰æ¨å®šï¼š
- å‹•è©ã®ç¨®é¡ â†’ ä¸»èªã®ç¨®é¡ï¼ˆç§»å‹•/æ‘‚å–/ç”Ÿæ´»å‹•ä½œï¼‰
- æ•¬èªã®ä½¿ç”¨ â†’ ä¸»èªã®ç‰¹å®šï¼ˆå°Šæ•¬èª=ç›¸æ‰‹ã€è¬™è­²èª=è‡ªåˆ†ï¼‰
- æ–‡æœ«ã®èªå°¾ â†’ ä¸»èªã®ç‰¹å®šï¼ˆã€œã¦ãã ã•ã„=ç›¸æ‰‹ã€ã€œãŸã„=è‡ªåˆ†ï¼‰

ã€ã‚¹ãƒ†ãƒƒãƒ—3: Modalityè­˜åˆ¥ã€‘
ç™ºè©±ã®æ„å›³ã‚’ç‰¹å®šï¼š
- ä¾é ¼: ã€œã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿ/ã€œã¦ãã‚Œã‚‹ï¼Ÿ
- ç¢ºèª: ã€œã—ã¦ã‚‹ï¼Ÿ/ã€œãªã®ï¼Ÿ
- ææ¡ˆ: ã€œã—ãªã„ï¼Ÿ/ã€œã©ã†ï¼Ÿ
- ç¾©å‹™: ã€œã—ãªãã‚ƒ/ã€œã™ã¹ã

ã€ã‚¹ãƒ†ãƒƒãƒ—4: ç¿»è¨³å®Ÿè¡Œã€‘
ã‚¹ãƒ†ãƒƒãƒ—1-3ã®åˆ†æã«åŸºã¥ãç¿»è¨³

ã€å‡ºåŠ›å½¢å¼ã€‘
{
  "ner_analysis": {
    "entities": [
      {"text": "ãŠã†ãŸ", "type": "Person", "reason": "å¾Œã‚ã«ã€Œå¯ã‚‹ã€ãŒç¶šã"}
    ]
  },
  "zero_anaphora": {
    "inferred_subject": "I",
    "reason": "æ–‡æœ«ãŒã€œã¾ã™ï¼ˆç™ºè©±è€…ã®è¡Œå‹•ï¼‰"
  },
  "modality": {
    "class": "request",
    "marker": "ã€œã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿ"
  },
  "translation": "...",
  "reverse_translation": "..."
}
```

### 3.2 Few-shotä¾‹ç¤º

```
ã€ä¾‹1: åè©è­˜åˆ¥ã€‘
æ—¥æœ¬èª: ã€ŒãŠã†ãŸãŒå¯ã¦ã‹ã‚‰å‘ã‹ã„ã¾ã™ã€
åˆ†æ: ã€ŒãŠã†ãŸã€= äººåï¼ˆå¾Œã‚ã«ã€Œå¯ã‚‹ã€ãŒç¶šãï¼‰
è‹±èª: "I'll head over after Ota goes to sleep."

ã€ä¾‹2: ã‚¼ãƒ­ç…§å¿œã€‘
æ—¥æœ¬èª: ã€Œæ˜æ—¥ä¼šè­°ã«è¡Œãã¾ã™ã€
åˆ†æ: ä¸»èªã¯ã€Œç§ã€ï¼ˆæ–‡æœ«ãŒã€œã¾ã™ï¼‰
è‹±èª: "I will go to the meeting tomorrow."

ã€ä¾‹3: Modalityä¿æŒã€‘
æ—¥æœ¬èª: ã€Œè³‡æ–™ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿã€
åˆ†æ: modality=ä¾é ¼ï¼ˆã€œã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿï¼‰
è‹±èª: "Can you send me the materials?"
```

---

## 4. ã‚³ãƒ¼ãƒ‰åˆ†æã¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 4.1 ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰å•é¡Œç‚¹

#### å•é¡Œ1: äº‹å‰ç”Ÿæˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

```typescript
// App.tsx - ç¾çŠ¶ã®å•é¡Œã‚³ãƒ¼ãƒ‰
useEffect(() => {
  const timer = setTimeout(async () => {
    await generateAndCacheUiBuckets({...})  // â† éåŒæœŸã§å®Œäº†ã‚’å¾…ãŸãªã„
  }, 500)
  return () => clearTimeout(timer)
}, [inputText])

// å•é¡Œ: ç”Ÿæˆå®Œäº†å‰ã«ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ“ä½œã•ã‚Œã‚‹ã¨å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

**æ”¹å–„æ¡ˆ**ï¼š
```typescript
// æ”¹å–„ç‰ˆ
useEffect(() => {
  const abortController = new AbortController()
  
  const timer = setTimeout(async () => {
    setPrefetchStatus('loading')  // ç”Ÿæˆä¸­çŠ¶æ…‹ã‚’æ˜ç¤º
    
    try {
      await generateAndCacheUiBuckets({
        ...,
        signal: abortController.signal
      })
      
      if (!abortController.signal.aborted) {
        setPrefetchStatus('completed')  // å®Œäº†é€šçŸ¥
        // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ä½ç½®ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³æ™‚åæ˜ 
        updatePreviewFromCache(activeToneBucket)
      }
    } catch (error) {
      if (!abortController.signal.aborted) {
        setPrefetchStatus('error')
      }
    }
  }, 300)  // 300msã«çŸ­ç¸®
  
  return () => {
    abortController.abort()
    clearTimeout(timer)
  }
}, [inputText])
```

#### å•é¡Œ2: ç¿»è¨³ã¨é€†ç¿»è¨³ã®ä¹–é›¢

```typescript
// groq.ts - ç¾çŠ¶ã®å•é¡Œ
export async function translateFull(options: TranslateOptions): Promise<TranslationResult> {
  // ç¿»è¨³ã¨é€†ç¿»è¨³ã‚’åŒæ™‚ã«ç”Ÿæˆã™ã‚‹ãŒã€å“è³ªãƒã‚§ãƒƒã‚¯ãŒä¸ååˆ†
  const parsed = parseJsonResponse<TranslationResult>(response)
  
  // å•é¡Œ: ç¿»è¨³ã¨é€†ç¿»è¨³ã®å¯¾å¿œé–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãªã„
  return parsed
}
```

**æ”¹å–„æ¡ˆ**ï¼š
```typescript
// æ”¹å–„ç‰ˆ
interface TranslationResult {
  translation: string
  reverse_translation: string
  risk: 'low' | 'med' | 'high'
  alignment_score?: number  // ç¿»è¨³ã¨é€†ç¿»è¨³ã®ä¸€è‡´åº¦
}

function calculateAlignmentScore(
  original: string,
  translation: string,
  reverseTranslation: string
): number {
  // 1. åŸæ–‡ã¨é€†ç¿»è¨³ã®ç·¨é›†è·é›¢ã‚’è¨ˆç®—
  const distance = calculateEditDistance(original, reverseTranslation)
  const maxLen = Math.max(original.length, reverseTranslation.length)
  
  // 2. ä¸€è‡´åº¦ã‚¹ã‚³ã‚¢ï¼ˆ1.0ãŒå®Œå…¨ä¸€è‡´ï¼‰
  const score = 1 - (distance / maxLen)
  
  return score
}

export async function translateFull(
  options: TranslateOptions
): Promise<TranslationResult> {
  const response = await callGeminiAPI(...)
  const parsed = parseJsonResponse<TranslationResult>(response)
  
  // ç¿»è¨³ã¨é€†ç¿»è¨³ã®ä¸€è‡´åº¦ã‚’è¨ˆç®—
  const alignmentScore = calculateAlignmentScore(
    options.sourceText,
    parsed.translation,
    parsed.reverse_translation
  )
  
  // ä¸€è‡´åº¦ãŒä½ã„å ´åˆã¯ãƒªã‚¹ã‚¯ã‚’ä¸Šã’ã‚‹
  if (alignmentScore < 0.7) {
    parsed.risk = 'high'
    parsed.alignment_score = alignmentScore
  }
  
  return parsed
}
```

#### å•é¡Œ3: åè©èªè­˜ã®æ¬ å¦‚

```typescript
// ç¾çŠ¶: NERå‡¦ç†ãŒãªã„

// æ”¹å–„ç‰ˆ: NERãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ 
interface Entity {
  text: string
  type: 'Person' | 'Organization' | 'Location' | 'Common'
  confidence: number
}

function extractEntities(text: string): Entity[] {
  const entities: Entity[] = []
  
  // äººåãƒ‘ã‚¿ãƒ¼ãƒ³: ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠ + äººé–“ã®å‹•ä½œ
  const personPattern = /([ã‚-ã‚“ã‚¢-ãƒ³]+)(ãŒ|ã¯|ã‚’|ã«|ã¨)(å¯ã‚‹|æ¥ã‚‹|é£Ÿã¹ã‚‹|è©±ã™|åƒã)/g
  let match
  while ((match = personPattern.exec(text)) !== null) {
    entities.push({
      text: match[1],
      type: 'Person',
      confidence: 0.9
    })
  }
  
  // ãã®ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³...
  
  return entities
}

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«NERçµæœã‚’çµ„ã¿è¾¼ã‚€
function buildSystemPrompt(sourceText: string): string {
  const entities = extractEntities(sourceText)
  
  let entitySection = ''
  if (entities.length > 0) {
    entitySection = `
ã€åè©è­˜åˆ¥çµæœã€‘
${entities.map(e => `- "${e.text}": ${e.type}ï¼ˆä¿¡é ¼åº¦: ${e.confidence}ï¼‰`).join('\n')}

ã€æ³¨æ„ã€‘ä¸Šè¨˜ã®åè©åˆ†é¡ã‚’å°Šé‡ã—ã¦ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚
`
  }
  
  return `${BASE_SYSTEM_PROMPT}${entitySection}`
}
```

---

## 5. æ¤œè¨¼ã¨æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«

### 5.1 æ¤œè¨¼ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| # | ãƒ†ã‚¹ãƒˆæ–‡ | æ¤œè¨¼é …ç›® |
|---|----------|----------|
| 1 | ã€ŒãŠã†ãŸãŒå¯ã¦ã‹ã‚‰å‘ã‹ã„ã¾ã™ã€ | åè©èªè­˜ï¼ˆäººåï¼‰ |
| 2 | ã€Œæ˜æ—¥ä¼šè­°ã«è¡Œãã¾ã™ã€ | ã‚¼ãƒ­ç…§å¿œï¼ˆä¸»èªè£œå®Œï¼‰ |
| 3 | ã€Œè³‡æ–™ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿã€ | modalityä¿æŒï¼ˆä¾é ¼ï¼‰ |
| 4 | ã€Œé…ã‚Œã¦ã”ã‚ã‚“ã€é›»è»ŠãŒæ­¢ã¾ã£ã¦ãŸã€ | ãƒˆãƒ¼ãƒ³èª¿æ•´ï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰ |
| 5 | ã€Œæ˜æ—¥ã®ä¼šè­°ã®è³‡æ–™ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã‚‹ï¼Ÿã€ | çµ±åˆãƒ†ã‚¹ãƒˆ |

### 5.2 æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Ÿè£…   â”‚ â†’ â”‚  æ¤œè¨¼   â”‚ â†’ â”‚  åˆ†æ   â”‚ â†’ â”‚  æ”¹å–„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‚è€ƒæ–‡çŒ®

- [^2^] Multi-Agent System for High-Quality Translation (2025)
- [^7^] CodeNER: Code Prompting for Named Entity Recognition (2025)
- [^11^] Japanese Zero Anaphora Resolution using Machine Translation
- [^12^] Collaborative Multi-Agent Translation Systems

---

## ã¾ã¨ã‚

| èª²é¡Œ | ç ”ç©¶ãƒ™ãƒ¼ã‚¹ã®è§£æ±ºç­– | å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ |
|------|-------------------|-------------|
| åè©èªè­˜ | NERãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ [^7^] | ç¿»è¨³å‰ã«åè©åˆ†é¡ |
| ã‚¼ãƒ­ç…§å¿œ | æ–‡è„ˆè§£æ [^11^] | å‹•è©/æ•¬èª/èªå°¾ã‹ã‚‰æ¨å®š |
| modality | æ„å›³ã‚¿ã‚°ä»˜ã‘ [^2^] | ç™ºè©±æ„å›³ã‚’æ˜ç¤ºçš„ã«è­˜åˆ¥ |
| ã‚¹ãƒ”ãƒ¼ãƒ‰ | Naniæ–¹å¼ | äº‹å‰ç”Ÿæˆ + ã‚­ãƒ£ãƒƒã‚·ãƒ¥é€£å‹• |



---

## 6. è©³ç´°å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 6.1 åè©èªè­˜ï¼ˆNERï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Œå…¨å®Ÿè£…

```typescript
// ner.ts - åè©èªè­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

export type EntityType = 'Person' | 'Organization' | 'Location' | 'Common' | 'Product';

export interface Entity {
  text: string;
  type: EntityType;
  confidence: number;
  start: number;
  end: number;
}

// äººååˆ¤å®šãƒ‘ã‚¿ãƒ¼ãƒ³
const PERSON_PATTERNS = [
  // ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠ + äººé–“ã®å‹•ä½œ
  { pattern: /([ã‚-ã‚“ã‚¢-ãƒ³]+)(ãŒ|ã¯|ã‚’|ã«|ã¨)(å¯ã‚‹|æ¥ã‚‹|é£Ÿã¹ã‚‹|è©±ã™|åƒã|èµ°ã‚‹|æ­©ã|åº§ã‚‹|ç«‹ã¤)/g, confidence: 0.9 },
  // ã•ã‚“/ãã‚“/ã¡ã‚ƒã‚“ä»˜ã
  { pattern: /([ã‚-ã‚“ã‚¢-ãƒ³ä¸€-é¾¯]{1,5})(ã•ã‚“|ãã‚“|ã¡ã‚ƒã‚“|æ§˜|æ®¿)/g, confidence: 0.95 },
  // äººåã‚‰ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ2-4æ–‡å­—ã®ã²ã‚‰ãŒãªï¼‰
  { pattern: /([ã‚-ã‚“]{2,4})(ã•ã‚“|ãã‚“|ã¡ã‚ƒã‚“|ãŒ|ã¯)/g, confidence: 0.7 },
];

// çµ„ç¹”ååˆ¤å®šãƒ‘ã‚¿ãƒ¼ãƒ³
const ORG_PATTERNS = [
  { pattern: /([ä¸€-é¾¯ã‚-ã‚“ã‚¢-ãƒ³]+)(æ ªå¼ä¼šç¤¾|ä¼šç¤¾|å¤§å­¦|ç—…é™¢|éŠ€è¡Œ|å­¦æ ¡)/g, confidence: 0.95 },
  { pattern: /([A-Z][a-z]+)(Inc\.?|Corp\.?|Ltd\.?|Co\.)/g, confidence: 0.9 },
];

// åœ°ååˆ¤å®šãƒ‘ã‚¿ãƒ¼ãƒ³
const LOCATION_PATTERNS = [
  { pattern: /(æ±äº¬|å¤§é˜ª|äº¬éƒ½|åå¤å±‹|ç¦å²¡|æœ­å¹Œ|ä»™å°|åºƒå³¶|æ²–ç¸„|åŒ—æµ·é“)/g, confidence: 0.95 },
  { pattern: /([ä¸€-é¾¯ã‚-ã‚“]+)(éƒ½|åºœ|çœŒ|å¸‚|åŒº|ç”º|æ‘)/g, confidence: 0.85 },
];

// è£½å“ååˆ¤å®šãƒ‘ã‚¿ãƒ¼ãƒ³
const PRODUCT_PATTERNS = [
  { pattern: /(iPhone|iPad|MacBook|AirPods|Apple Watch|Galaxy|Pixel)/g, confidence: 0.98 },
  { pattern: /([A-Z][a-zA-Z0-9]*)(Pro|Max|Ultra|Mini)/g, confidence: 0.85 },
];

export function extractEntities(text: string): Entity[] {
  const entities: Entity[] = [];
  const seen = new Set<string>();

  // äººåæŠ½å‡º
  for (const { pattern, confidence } of PERSON_PATTERNS) {
    let match;
    while ((match = pattern.exec(text)) !== null) {
      const key = `${match[1]}_${match.index}`;
      if (!seen.has(key)) {
        entities.push({
          text: match[1],
          type: 'Person',
          confidence,
          start: match.index,
          end: match.index + match[1].length
        });
        seen.add(key);
      }
    }
  }

  // çµ„ç¹”åæŠ½å‡º
  for (const { pattern, confidence } of ORG_PATTERNS) {
    let match;
    while ((match = pattern.exec(text)) !== null) {
      const key = `${match[1]}_${match.index}`;
      if (!seen.has(key)) {
        entities.push({
          text: match[0],
          type: 'Organization',
          confidence,
          start: match.index,
          end: match.index + match[0].length
        });
        seen.add(key);
      }
    }
  }

  // åœ°åæŠ½å‡º
  for (const { pattern, confidence } of LOCATION_PATTERNS) {
    let match;
    while ((match = pattern.exec(text)) !== null) {
      const key = `${match[0]}_${match.index}`;
      if (!seen.has(key)) {
        entities.push({
          text: match[0],
          type: 'Location',
          confidence,
          start: match.index,
          end: match.index + match[0].length
        });
        seen.add(key);
      }
    }
  }

  // è£½å“åæŠ½å‡º
  for (const { pattern, confidence } of PRODUCT_PATTERNS) {
    let match;
    while ((match = pattern.exec(text)) !== null) {
      const key = `${match[0]}_${match.index}`;
      if (!seen.has(key)) {
        entities.push({
          text: match[0],
          type: 'Product',
          confidence,
          start: match.index,
          end: match.index + match[0].length
        });
        seen.add(key);
      }
    }
  }

  return entities.sort((a, b) => a.start - b.start);
}

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨NERã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
export function generateNerSection(entities: Entity[]): string {
  if (entities.length === 0) return '';

  const lines = entities.map(e => {
    const typeLabels: Record<EntityType, string> = {
      Person: 'äººå',
      Organization: 'çµ„ç¹”å',
      Location: 'åœ°å',
      Product: 'è£½å“å',
      Common: 'ä¸€èˆ¬åè©'
    };
    return `- "${e.text}": ${typeLabels[e.type]}ï¼ˆä¿¡é ¼åº¦: ${Math.round(e.confidence * 100)}%ï¼‰`;
  });

  return `
ã€åè©è­˜åˆ¥çµæœã€‘
${lines.join('\n')}

ã€ç¿»è¨³æ™‚ã®æ³¨æ„ã€‘
- äººåã¯éŸ³è¨³ï¼ˆOuta, Tanakaç­‰ï¼‰
- çµ„ç¹”åã¯æ¨™æº–çš„ãªè‹±èªè¡¨è¨˜ã‚’ä½¿ç”¨
- åœ°åã¯ä¸€èˆ¬çš„ãªè‹±èªè¡¨è¨˜ã‚’ä½¿ç”¨
- è£½å“åã¯å…¬å¼ã®è‹±èªè¡¨è¨˜ã‚’ä½¿ç”¨
`;
}
```

### 6.2 ã‚¼ãƒ­ç…§å¿œè§£æ±ºãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

```typescript
// zeroAnaphora.ts - ã‚¼ãƒ­ç…§å¿œè§£æ±ºãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

export interface ZeroAnaphoraResult {
  inferredSubject: string;
  confidence: number;
  reason: string;
}

// å‹•è©â†’ä¸»èªã‚¿ã‚¤ãƒ—ãƒãƒƒãƒ”ãƒ³ã‚°
const VERB_TO_SUBJECT: Record<string, string[]> = {
  // ç§»å‹•å‹•è©
  'æ¥ã‚‹': ['I', 'you', 'he', 'she'],
  'è¡Œã': ['I', 'you', 'he', 'she'],
  'å¸°ã‚‹': ['I', 'you', 'he', 'she'],
  'æˆ»ã‚‹': ['I', 'you', 'he', 'she'],
  // æ‘‚å–å‹•è©
  'é£Ÿã¹ã‚‹': ['I', 'you', 'he', 'she'],
  'é£²ã‚€': ['I', 'you', 'he', 'she'],
  // ç”Ÿæ´»å‹•ä½œ
  'å¯ã‚‹': ['I', 'you', 'he', 'she'],
  'èµ·ãã‚‹': ['I', 'you', 'he', 'she'],
  'åƒã': ['I', 'you', 'he', 'she'],
  // ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  'è©±ã™': ['I', 'you', 'he', 'she'],
  'èã': ['I', 'you', 'he', 'she'],
  'è¦‹ã‚‹': ['I', 'you', 'he', 'she'],
};

// å°Šæ•¬èªâ†’ä¸»èª
const RESPECTFUL_TO_SUBJECT: Record<string, string> = {
  'ã„ã‚‰ã£ã—ã‚ƒã‚‹': 'you',
  'ãŠã£ã—ã‚ƒã‚‹': 'you',
  'ãªã•ã‚‹': 'you',
  'ãã ã•ã‚‹': 'you',
};

// è¬™è­²èªâ†’ä¸»èª
const HUMBLE_TO_SUBJECT: Record<string, string> = {
  'ä¼ºã†': 'I',
  'å‚ã‚‹': 'I',
  'ç”³ã™': 'I',
  'ã„ãŸã™': 'I',
  'ã¾ã„ã‚‹': 'I',
};

// æ–‡æœ«ãƒ‘ã‚¿ãƒ¼ãƒ³â†’ä¸»èª
const ENDING_TO_SUBJECT: Record<string, string> = {
  'ã¦ãã ã•ã„': 'you',
  'ã¦ã„ãŸã ã‘ã¾ã™ã‹': 'you',
  'ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹': 'you',
  'ã¦ãã‚Œã¾ã™ã‹': 'you',
  'ãŸã„': 'I',
  'ãŸããªã„': 'I',
  'ãŸã‹ã£ãŸ': 'I',
};

export function resolveZeroAnaphora(
  text: string,
  context?: { previousText?: string; nextText?: string }
): ZeroAnaphoraResult {
  // 1. å‹•è©ã‹ã‚‰æ¨å®š
  for (const [verb, subjects] of Object.entries(VERB_TO_SUBJECT)) {
    if (text.includes(verb)) {
      return {
        inferredSubject: subjects[0],
        confidence: 0.7,
        reason: `å‹•è©ã€Œ${verb}ã€ã‹ã‚‰ä¸»èªã‚’æ¨å®š`
      };
    }
  }

  // 2. æ•¬èªã‹ã‚‰æ¨å®š
  for (const [verb, subject] of Object.entries(RESPECTFUL_TO_SUBJECT)) {
    if (text.includes(verb)) {
      return {
        inferredSubject: subject,
        confidence: 0.9,
        reason: `å°Šæ•¬èªã€Œ${verb}ã€ã‹ã‚‰ç›¸æ‰‹ã‚’ä¸»èªã¨ã—ã¦æ¨å®š`
      };
    }
  }

  for (const [verb, subject] of Object.entries(HUMBLE_TO_SUBJECT)) {
    if (text.includes(verb)) {
      return {
        inferredSubject: subject,
        confidence: 0.9,
        reason: `è¬™è­²èªã€Œ${verb}ã€ã‹ã‚‰è‡ªåˆ†ã‚’ä¸»èªã¨ã—ã¦æ¨å®š`
      };
    }
  }

  // 3. æ–‡æœ«ã‹ã‚‰æ¨å®š
  for (const [ending, subject] of Object.entries(ENDING_TO_SUBJECT)) {
    if (text.endsWith(ending) || text.includes(ending)) {
      return {
        inferredSubject: subject,
        confidence: 0.85,
        reason: `æ–‡æœ«ã€Œ${ending}ã€ã‹ã‚‰ä¸»èªã‚’æ¨å®š`
      };
    }
  }

  // 4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  return {
    inferredSubject: 'I',
    confidence: 0.5,
    reason: 'æ–‡è„ˆã‹ã‚‰ä¸»èªã‚’æ¨å®šã§ããªã‹ã£ãŸãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ŒIã€ã‚’ä½¿ç”¨'
  };
}

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ã‚¼ãƒ­ç…§å¿œã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
export function generateZeroAnaphoraSection(result: ZeroAnaphoraResult): string {
  return `
ã€ã‚¼ãƒ­ç…§å¿œè§£æ±ºçµæœã€‘
- æ¨å®šä¸»èª: "${result.inferredSubject}"
- ä¿¡é ¼åº¦: ${Math.round(result.confidence * 100)}%
- ç†ç”±: ${result.reason}

ã€ç¿»è¨³æ™‚ã®æ³¨æ„ã€‘
æ—¥æœ¬èªã®çœç•¥ä¸»èªã‚’ã€Œ${result.inferredSubject}ã€ã§è£œå®Œã—ã¦ãã ã•ã„ã€‚
`;
}
```

### 6.3 Modalityè­˜åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

```typescript
// modality.ts - Modalityè­˜åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

export type ModalityClass = 'request' | 'confirmation' | 'suggestion' | 'obligation' | 'statement';

export interface ModalityResult {
  class: ModalityClass;
  confidence: number;
  marker: string;
}

// Modalityãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©
const MODALITY_PATTERNS: Array<{
  class: ModalityClass;
  patterns: RegExp[];
  confidence: number;
}> = [
  {
    class: 'request',
    patterns: [
      /ã¦ã‚‚ã‚‰ãˆã‚‹[ï¼Ÿ?]?$/,
      /ã¦ãã‚Œã‚‹[ï¼Ÿ?]?$/,
      /ã¦ã„ãŸã ã‘ã¾ã™ã‹[ï¼Ÿ?]?$/,
      /ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹[ï¼Ÿ?]?$/,
      /ã¦ãã ã•ã„[ã€‚ï¼]?$/,
      /ã¦ãã‚Œã¾ã›ã‚“ã‹[ï¼Ÿ?]?$/,
      /ã¦ã‚‚ã‚‰ãˆãªã„[ï¼Ÿ?]?$/,
    ],
    confidence: 0.9
  },
  {
    class: 'confirmation',
    patterns: [
      /ã—ã¦ã‚‹[ï¼Ÿ?]?$/,
      /ã—ã¦ã„ã‚‹[ï¼Ÿ?]?$/,
      /ãªã®[ï¼Ÿ?]?$/,
      /ã§ã™ã‹[ï¼Ÿ?]?$/,
      /ã¾ã™ã‹[ï¼Ÿ?]?$/,
      /ã§ã—ã‚‡ã†ã‹[ï¼Ÿ?]?$/,
      /ã ã‚ˆã­[ï¼Ÿ?]?$/,
    ],
    confidence: 0.85
  },
  {
    class: 'suggestion',
    patterns: [
      /ã—ãªã„[ï¼Ÿ?]?$/,
      /ã©ã†[ï¼Ÿ?]?$/,
      /ã©ã†ã§ã™ã‹[ï¼Ÿ?]?$/,
      /ã©ã†ã§ã—ã‚‡ã†[ï¼Ÿ?]?$/,
      /ã¿ãªã„[ï¼Ÿ?]?$/,
      /ã¾ã—ã‚‡ã†ã‹[ï¼Ÿ?]?$/,
    ],
    confidence: 0.85
  },
  {
    class: 'obligation',
    patterns: [
      /ã—ãªãã‚ƒ[ã€‚ï¼]?$/,
      /ã—ãªãã¡ã‚ƒ[ã€‚ï¼]?$/,
      /ã™ã¹ã[ã€‚ï¼]?$/,
      /ãªã‘ã‚Œã°ãªã‚‰ãªã„[ã€‚ï¼]?$/,
      /ãªãã‚ƒã„ã‘ãªã„[ã€‚ï¼]?$/,
    ],
    confidence: 0.9
  }
];

// è‹±èªã§ã®Modalityè¡¨ç¾
const ENGLISH_MODALITY: Record<ModalityClass, string[]> = {
  request: ['Can you', 'Could you', 'Would you', 'Please', 'Will you'],
  confirmation: ['Are you', 'Do you', 'Is it', 'Did you', 'Have you'],
  suggestion: ['Shall we', 'How about', 'What about', "Why don't we"],
  obligation: ['You must', 'You should', 'You have to', 'You need to'],
  statement: [] // ç‰¹åˆ¥ãªãƒãƒ¼ã‚«ãƒ¼ãªã—
};

export function detectModality(text: string): ModalityResult {
  for (const { class: modalityClass, patterns, confidence } of MODALITY_PATTERNS) {
    for (const pattern of patterns) {
      if (pattern.test(text)) {
        const match = text.match(pattern);
        return {
          class: modalityClass,
          confidence,
          marker: match ? match[0] : ''
        };
      }
    }
  }

  return {
    class: 'statement',
    confidence: 0.5,
    marker: ''
  };
}

// è‹±èªã®Modalityè¡¨ç¾ã‚’å–å¾—
export function getEnglishModality(modality: ModalityClass): string[] {
  return ENGLISH_MODALITY[modality];
}

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨Modalityã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
export function generateModalitySection(result: ModalityResult): string {
  const classLabels: Record<ModalityClass, string> = {
    request: 'ä¾é ¼',
    confirmation: 'ç¢ºèª',
    suggestion: 'ææ¡ˆ',
    obligation: 'ç¾©å‹™',
    statement: 'æ–­å®š'
  };

  const englishExpressions = getEnglishModality(result.class);

  return `
ã€Modalityè­˜åˆ¥çµæœã€‘
- ç™ºè©±æ„å›³: ${classLabels[result.class]}
- ä¿¡é ¼åº¦: ${Math.round(result.confidence * 100)}%
- ãƒãƒ¼ã‚«ãƒ¼: "${result.marker}"

ã€ç¿»è¨³æ™‚ã®æ³¨æ„ã€‘
ç™ºè©±æ„å›³ã€Œ${classLabels[result.class]}ã€ã‚’ä¿æŒã—ã¦ãã ã•ã„ã€‚
è‹±èªè¡¨ç¾ã®å€™è£œ: ${englishExpressions.join(', ')}
`;
}
```

### 6.4 çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼

```typescript
// promptBuilder.ts - çµ±åˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼

import { extractEntities, generateNerSection } from './ner';
import { resolveZeroAnaphora, generateZeroAnaphoraSection } from './zeroAnaphora';
import { detectModality, generateModalitySection } from './modality';

export interface AnalysisResult {
  ner: ReturnType<typeof extractEntities>;
  zeroAnaphora: ReturnType<typeof resolveZeroAnaphora>;
  modality: ReturnType<typeof detectModality>;
}

export function analyzeText(text: string): AnalysisResult {
  return {
    ner: extractEntities(text),
    zeroAnaphora: resolveZeroAnaphora(text),
    modality: detectModality(text)
  };
}

export function buildSystemPrompt(
  sourceText: string,
  sourceLang: string,
  targetLang: string,
  tone?: string,
  toneLevel?: number
): string {
  const analysis = analyzeText(sourceText);

  const basePrompt = `ã‚ãªãŸã¯${sourceLang}ã‹ã‚‰${targetLang}ã¸ã®ãƒ—ãƒ­ç¿»è¨³è€…ã§ã™ã€‚
ä»¥ä¸‹ã®åˆ†æçµæœã«åŸºã¥ã„ã¦ç¿»è¨³ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
`;

  const nerSection = generateNerSection(analysis.ner);
  const zeroAnaphoraSection = generateZeroAnaphoraSection(analysis.zeroAnaphora);
  const modalitySection = generateModalitySection(analysis.modality);

  const toneSection = tone ? `
ã€ãƒˆãƒ¼ãƒ³èª¿æ•´ã€‘
ãƒˆãƒ¼ãƒ³: ${tone}
ãƒ¬ãƒ™ãƒ«: ${toneLevel}%
` : '';

  const outputFormat = `
ã€å‡ºåŠ›å½¢å¼ã€‘
{
  "translation": "${targetLang}ã§ã®ç¿»è¨³",
  "reverse_translation": "${sourceLang}ã§ã®é€†ç¿»è¨³",
  "risk": "low|med|high"
}
`;

  return `${basePrompt}${nerSection}${zeroAnaphoraSection}${modalitySection}${toneSection}${outputFormat}`;
}
```

---

## 7. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŸºç›¤æ§‹ç¯‰
- [ ] NERãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè£… (`ner.ts`)
- [ ] ã‚¼ãƒ­ç…§å¿œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè£… (`zeroAnaphora.ts`)
- [ ] Modalityãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè£… (`modality.ts`)
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼å®Ÿè£… (`promptBuilder.ts`)

### Phase 2: çµ±åˆ
- [ ] `groq.ts`ã«åˆ†æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çµ±åˆ
- [ ] `App.tsx`ã®äº‹å‰ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®è¦‹ç›´ã—

### Phase 3: æ¤œè¨¼
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
- [ ] åè©èªè­˜ç²¾åº¦æ¸¬å®š
- [ ] ã‚¼ãƒ­ç…§å¿œè§£æ±ºç²¾åº¦æ¸¬å®š
- [ ] Modalityä¿æŒç²¾åº¦æ¸¬å®š

### Phase 4: æœ€é©åŒ–
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

