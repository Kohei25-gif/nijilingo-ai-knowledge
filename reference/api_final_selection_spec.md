# API最終選考 - 検証仕様

**作成日:** 2025-01-30
**ステータス:** 実行予定

---

## 目標
**llama-4-scout / gpt-oss-120b が「実際のフロー」で満点を取る**

## 「満点」の定義
1. **翻訳精度**: JA→EN / EN→JA が正確
2. **トーン差**: 0%/50%/100%が全部違う
3. **速度**: 許容範囲内

## 実際のフロー
FULL翻訳（0%） → PARTIAL（50%） → PARTIAL（100%）の3回連続API呼び出し

## 方法
1. **アプリの実プロンプト**を使う（groq.tsからそのままコピー）
2. 実際のフローで試す
3. ダメだったところを**フェーズ0のルール**に従って修正
4. **30回繰り返す**

## テスト内容
- **テスト文**: 3つ（起きたら連絡して / その服素敵だね / 遅れてごめん、電車が止まってた）
- **トーン**: casual / business / formal（3種類）
- **評価項目**:
  - 翻訳精度（JA→EN正確か、EN→JA正確か）
  - トーン差（0%/50%/100%が全部違うか）
  - フロー時間

## 使うプロンプト（絶対）
`src/services/groq.ts`から**そのままコピー**：
- `getToneStyleInstruction()` 
- `INVARIANT_RULES`
- `TONE_AND_EVALUATION_RULES`
- `PARTIAL_SYSTEM_PROMPT`
- `getFullPrompt()`

## 修正ルール（フェーズ0）
- Few-shot例の入れ方
- 否定形より肯定形で指示
- ロールの明確化
- 出力形式の指定方法
- 禁止事項は具体的に列挙
- 成功例と失敗例の両方を示す

## 出力（「API最終選考」タイトル）

### 進捗表
| モデル | 1回目 | 15回目 | 30回目 | 平均時間 |

### 最終評価
| モデル | 翻訳精度 | JA→EN | EN→JA | トーン差 | 単体速度 | フロー速度 | コスト |

---

## 対象API

| API | 現状 | 課題 |
|-----|------|------|
| llama-4-scout | 最速（921ms）、翻訳15/20、トーン差33% | トーン差が弱い |
| gpt-oss-120b | 翻訳17/20、トーン差100%、2.6秒 | 問題なし（確認用） |

## 参考
- フェーズ0詳細: `reference/api_auto_selection_pipeline.md`
- Phase 3/4/5結果: `data/api-benchmark-results.md`
