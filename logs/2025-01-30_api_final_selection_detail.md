# API最終選考 - 実験結果詳細

**日付:** 2025-01-30 02:43
**テスト者:** ベン
**対象API:** llama-4-scout, gpt-oss-120b

---

## 📊 最終結果サマリー

| モデル | 翻訳精度 | JA→EN | EN→JA | トーン差 | フロー速度 | コスト |
|--------|----------|-------|-------|----------|------------|--------|
| llama-4-scout | 15/20 | 7/10 | 8/10 | 44% | 921ms | $0.11/$0.34 |
| **gpt-oss-120b** | **17/20** | **9/10** | 8/10 | **78%** | 2631ms | $0.15/$0.60 |

### トーン別正答率

| モデル | casual | business | formal | 合計 |
|--------|--------|----------|--------|------|
| llama-4-scout | 1/3 | **3/3** | 0/3 | 4/9 (44%) |
| gpt-oss-120b | **3/3** | 2/3 | 2/3 | 7/9 (78%) |

---

## ① 各APIの得意・苦手（詳細）

### llama-4-scout

**得意なこと:**
- **businessトーン: 3/3 (100%)** - 安定して全問正解
- **速度: 921ms** - 最速（gpt-oss-120bの約3分の1）
- 基本的な翻訳は問題なくできる

**苦手なこと:**
- **formalトーン: 0/3 (0%)** - 全く差が出ない
  - 0%/50%/100%で同じ表現を返す傾向
  - 敬語のレベル差を理解できていない
- **casualトーン: 1/3 (33%)** - 不安定
  - スラング（じゃん、マジで）の使い分けが苦手
- **翻訳精度: 15/20** - 中程度
  - 主語省略が苦手
  - ニュアンスの保持が弱い

**llama-4-scoutの根本的問題:**
- Previewモデルであり、日本語の敬語レベルの微妙な差を理解できない
- 「です/ます」→「ございます」→「申し上げます」の段階的変化ができない
- formalとbusinessの区別がついていない可能性

### gpt-oss-120b

**得意なこと:**
- **casualトーン: 3/3 (100%)** - 10回目で全問正解達成
  - 「じゃん」「マジで」「めっちゃ」の使い分けができる
- **翻訳精度: 17/20** - 高い
  - JA→EN: 9/10（ほぼ完璧）
  - ニュアンス保持が良い
- **トーン差全体: 78%** - 高い安定性
- **コスパ: $0.15/$0.60** - miniの約1/3

**苦手なこと:**
- **businessトーン: 2/3 (67%)** - やや不安定
  - 時々0%と50%が同じになる
- **formalトーン: 2/3 (67%)** - やや不安定
  - 最高敬語（ございます等）の使い分けに迷う時がある
- **速度: 2631ms** - 遅め（llama-4-scoutの約3倍）

**gpt-oss-120bの改善ポイント:**
- businessとformalの差をより明確にするプロンプト
- 50%と100%の差をより強調する指示

---

## ② 改善が認められたプロンプト

**今回の実験では、プロンプト修正ロジックを実装していなかったため、
「修正による改善」は測定できなかった。**

ただし、以下のプロンプト要素が効果的だったと推測される：

### 効果があったと思われる要素

1. **具体的なトーンレベル説明**
```
【トーンレベル: 100% - めちゃくちゃカジュアル】
- 友達同士の超くだけた会話
- 英語なら省略形（gonna, wanna, gotta）
- 文法より勢い重視
```

2. **逆翻訳のトーン反映指示**
```
【最重要：全レベル異なる表現にすること】
0%, 50%, 100%は必ず全て異なる表現にすること。
- 英語（translation）も各レベルで必ず変える
- 逆翻訳（reverse_translation）も各レベルで必ず変える
```

3. **不変条件の明示**
```
【不変条件 - 翻訳時に絶対守ること】
1. entities - 数字、日付、時刻、金額、固有名詞を変えない
2. polarity - 肯定/否定を変えない
...
```

---

## ③ 改善しなかったプロンプト

**今回の実験では、以下の問題が解決されなかった：**

### llama-4-scoutでformalが0/3だった原因

現在のプロンプト:
```
【トーンレベル: 100% - めちゃくちゃ丁寧（最大級の敬語・謙譲語）】
- 最上級の敬意を示す表現
- 謙譲語・尊敬語を最大限に使用
- 例: "I would be deeply honored...", "Your esteemed presence..."
- 最高の礼儀と敬意
```

**問題点:**
- 日本語の敬語例が少ない
- 「ございます」「申し上げます」などの具体例がない
- llama-4-scoutは英語の例から日本語の敬語を推測できない

### gpt-oss-120bでbusinessが2/3だった原因

**問題点:**
- 0%と50%の差が曖昧
- 「丁寧だが堅すぎない」という指示が具体性に欠ける

---

## ④ 実際の10回目時点でのプロンプト全て

### システムプロンプト（buildSystemPrompt関数）

```
あなたは日本語から英語への翻訳の専門家です。

【不変条件 - 翻訳時に絶対守ること】
1. entities - 数字、日付、時刻、金額、固有名詞を変えない
2. polarity - 肯定/否定を変えない
3. locked_terms - 用語集の語句をそのまま使う
4. modality_class - 依頼/義務/提案のクラスを変えない
5. question/statement - 質問/断定を変えない
6. condition markers - if/unless/when等を保持
7. commitment - 約束を勝手に追加しない
8. stance_strength - 同意や感情の強さを勝手に変えない（例：OKをPerfectに変えない）

【逆翻訳ルール】
- 値は翻訳結果に従う
- 時刻表記は原文のスタイルに合わせる（15時→15時、3 PM→15時）

【トーン・評価語ルール】
1. トーンは口調のみ変更し、評価軸は変えない
2. cool/sick/dude/huh など評価軸を変える語は禁止
3. reverse_translation は意味を保持しつつ、トーン差を語尾・強調語で必ず表現する
4. 服の一般語は clothes/outfit を使う。"dress" は禁止

【絶対ルール - translation フィールド】
- "translation" は 英語 のみで出力すること
- 日本語の文字は絶対に混ぜない

【重要】翻訳スタイル指示 - 必ず従うこと
${toneInstruction}
${reverseInstruction}

必ず以下のJSON形式で出力してください：
{
  "translation": "英語のみの翻訳",
  "reverse_translation": "日本語のみの逆翻訳（トーン反映）",
  "risk": "low|med|high"
}
```

### トーン指示（getToneStyleInstruction関数）

#### casual 0%
```
【トーンレベル: 0% - 原文そのまま】
- 原文の意味をそのまま自然に翻訳
- 特別なスタイル変更なし
```

#### casual 50%
```
【トーンレベル: 50% - カジュアル】
- くだけた表現に
- 翻訳先の言語に合わせたカジュアル表現を使う
- 英語なら省略形OK（I'm, don't, can't）
- 親しみやすいトーン
```

#### casual 100%
```
【トーンレベル: 100% - めちゃくちゃカジュアル】
- 友達同士の超くだけた会話
- 翻訳先の言語に合わせたカジュアル表現を使う
- 英語なら省略形（gonna, wanna, gotta）
- 文法より勢い重視
```

#### business 0%
```
【トーンレベル: 0% - 原文そのまま】
- 原文の意味をそのまま自然に翻訳
- 特別なスタイル変更なし
```

#### business 50%
```
【トーンレベル: 50% - 標準のビジネス表現】
- 省略形は避ける
- 丁寧語を使う
- 例: "Could you please...", "I would like to..."
- プロフェッショナルなトーン
```

#### business 100%
```
【トーンレベル: 100% - めちゃくちゃビジネス（最大級にフォーマル）】
- 最高レベルのビジネス敬語
- 省略形は一切使わない
- 例: "I would be most grateful if...", "It is my pleasure to inform you that..."
- 格式高く丁重な表現
```

#### formal 0%
```
【トーンレベル: 0% - 原文そのまま】
- 原文の意味をそのまま自然に翻訳
- 特別なスタイル変更なし
```

#### formal 50%
```
【トーンレベル: 50% - 標準の丁寧表現】
- 丁寧な言い回し
- 例: "Would you mind...", "I appreciate..."
- 敬意あるトーン
```

#### formal 100%
```
【トーンレベル: 100% - めちゃくちゃ丁寧（最大級の敬語・謙譲語）】
- 最上級の敬意を示す表現
- 謙譲語・尊敬語を最大限に使用
- 例: "I would be deeply honored...", "Your esteemed presence..."
- 最高の礼儀と敬意
```

### 逆翻訳指示（getReverseTranslationInstruction関数）

```
【逆翻訳ルール】
- ${toneDescription}で表現すること
- レベル${toneLevel}%: 0%が最も控えめ、100%が最も強い表現

【最重要：全レベル異なる表現にすること】
0%, 50%, 100%は必ず全て異なる表現にすること。
- 英語（translation）も各レベルで必ず変える
- 逆翻訳（reverse_translation）も各レベルで必ず変える

【基本ルール】
- 疑問文は疑問文のまま（？で終わる）
- 平叙文は平叙文のまま
- 自然な日本語であること
```

---

## ⑤ シュワちゃんへのプロンプト

以下のプロンプトをシュワちゃん（Claude Swarm）に投げて、100点を取るための改善案を検討してもらう。

---

### 🤖 シュワちゃんへのプロンプト

```
# NijiLingo API トーン差検証 - 100点達成のための改善提案依頼

## 📋 背景

翻訳アプリ「NijiLingo」で使用するLLM APIのトーン差検証を行った。
目標は「0%/50%/100%で全て異なる表現を出力すること」だが、現状は最高78%。

## 📊 現状の結果

| モデル | casual | business | formal | 合計 |
|--------|--------|----------|--------|------|
| llama-4-scout | 1/3 | 3/3 | 0/3 | 44% |
| gpt-oss-120b | 3/3 | 2/3 | 2/3 | 78% |

## 🔍 各APIの問題点

### llama-4-scout
- formalトーンが全く機能しない（0/3）
- 日本語の敬語レベルの段階的変化を理解できない
- 「ございます」「申し上げます」等の敬語が出ない

### gpt-oss-120b
- businessとformalで時々0%と50%が同じになる
- 差をつけるべきところで同じ表現を返す

## 📝 現在のプロンプト構造

詳細は以下のファイルを参照：
`/Users/takakikohei/clawd/nijilingo-ai-knowledge/logs/2025-01-30_api_final_selection_detail.md`
の「④ 実際の10回目時点でのプロンプト全て」セクション

## 🎯 目標

トーン差検証で100%（9/9）を達成するためのプロンプト改善案を提案してほしい。

## 👥 エージェント構成（最低5人）

以下のエージェントを召集して分析・提案を行ってください：

1. **プロンプトエンジニア**
   - プロンプト設計の専門家
   - Few-shot、Chain-of-Thought等のテクニックに詳しい
   - 担当: プロンプト構造の改善案

2. **日本語言語学者**
   - 日本語の敬語体系の専門家
   - 「です/ます」「ございます」「申し上げます」の使い分けに詳しい
   - 担当: 日本語トーン差の具体例作成

3. **LLMモデル分析官**
   - llama-4-scoutとgpt-oss-120bの特性を分析
   - 各モデルの得意・不得意を把握
   - 担当: モデル別の最適化戦略

4. **品質保証エンジニア**
   - テスト設計の専門家
   - 「トーン差が出ているか」の判定ロジックを検証
   - 担当: 評価基準の改善案

5. **翻訳専門家**
   - 日英翻訳の実務経験者
   - ビジネス/フォーマル/カジュアルの使い分けに詳しい
   - 担当: 実用的な翻訳例の提供

6. **システムアーキテクト**（オプション）
   - 複数API組み合わせ戦略
   - フォールバック設計
   - 担当: アーキテクチャレベルの改善案

## 📤 出力形式

以下の形式で出力してください：

### 1. 問題分析（各エージェントの見解）
### 2. 改善案（優先度順）
### 3. 改善後のプロンプト例（完全版）
### 4. 実装ステップ（具体的な作業手順）
### 5. 期待される効果（定量的な予測）

## ⚠️ 制約

- アプリのコード（groq.ts）は変更せず、プロンプトのみで改善する
- 速度は大幅に遅くならないこと（3秒以内目標）
- コストは現状の2倍以内に抑える

---

よろしくお願いします！
```

---

## 📁 ファイルの場所

この詳細レポート:
`nijilingo-ai-knowledge/logs/2025-01-30_api_final_selection_detail.md`

シュワちゃんがアクセスできるGitHubリポジトリ:
`https://github.com/Kohei25-gif/nijilingo-ai-knowledge`

---

## 🔄 次のステップ

1. シュワちゃんにプロンプトを投げる
2. 改善案をもらう
3. 改善後のプロンプトで再検証
4. 100%達成を目指す
