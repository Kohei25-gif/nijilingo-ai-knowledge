# NijiLingo 開発セッション記録

**日付:** 2026年1月29日
**参加者:** きみちゃん (Kimi) / ベン (Claude)
**目的:** 翻訳アプリのバグ修正とプロンプト改善

---

## 本日の成果

### 検証で判明した核心問題

1. **日英乖離 (最重要)**
   - 日本語（逆翻訳）は変わるが英語（翻訳）は同じ
   - 原因: 翻訳と逆翻訳のキャッシュキーがずれている

2. **操作しないと変わらない (最重要)**
   - スライダー操作時に翻訳が更新されない
   - 原因: 事前生成完了前にスライダー操作される

3. **名詞認識エラー (中)**
   - 「おうた」→「singing」など
   - 原因: 固有名詞と一般名詞の区別ができていない

4. **主語省略誤解 (中)**
   - ゼロ照応解決ロジックなし

5. **modality_class変更 (低)**
   - PARTIAL編集で意図が変わる

---

## 明日やること（優先順）

### Phase 1: 日英乖離問題の解決（最重要）

**問題:** 日本語（逆翻訳）は変わるが英語（翻訳）は同じ
**原因:** 翻訳と逆翻訳のキャッシュキーがずれている

**対策:**
1. alignment_score計算関数の実装
2. キャッシュキーの統合
3. 翻訳と逆翻訳を同じタイミングで生成

**参考コード:** groq_日本語ベース.ts の translateFull 関数

### Phase 2: 事前生成の改善

**問題:** 操作しないと翻訳が変わらない
**原因:** 事前生成完了前にスライダー操作される

**対策:**
4. 生成状態をUIに表示（loading/completed/error）
5. 生成完了時に自動反映
6. キャッシュミス時のフォールバック

**参考コード:** App_日本語ベース.tsx の useEffect（事前生成）

### Phase 3: NERモジュールの統合

**対策:**
7. ner.ts を作成
8. groq.ts のプロンプトにNER結果を組み込む
9. テスト: 「おうたが寝てから」が正しく翻訳されるか

---

## 参考資料

### GitHubリポジトリ
- **メイン:** https://github.com/Kohei25-gif/nijilingo-ai-knowledge
- **App:** https://github.com/Kohei25-gif/nijilingo-ai-knowledge/blob/main/src/App_日本語ベース.tsx
- **翻訳API:** https://github.com/Kohei25-gif/nijilingo-ai-knowledge/blob/main/src/groq_日本語ベース.ts

### ドキュメント（outputフォルダに保存済み）
- nijilingo_complete_guide_v2.md: 包括的設計ガイド
- agentswarm_translation_nani_prompt.md: Agent Swarm向けプロンプト

### 研究論文
- CodeNER: NERプロンプト設計
- Japanese Zero Anaphora Resolution: ゼロ照応解決
- Multi-Agent System: modality保持

---

## 未解決の疑問

1. **キャッシュキーの形式:** 現在のキー形式で本当に問題ないか？
2. **PARTIAL編集の制約:** modality_class保持をどこまで厳密にするか？
3. **ロード速度:** 100ms→0msにする際のパフォーマンス影響

---

## 次回セッション開始時の流れ

1. **GitHubリポジトリを確認**
   → https://github.com/Kohei25-gif/nijilingo-ai-knowledge

2. **tasks/todo.md を確認**
   → 現在のタスク状況を把握

3. **前回の続きから開始**
   → 日英乖離問題の解決から

---

## メモ

- Nani翻訳の「爆速UI」を参考に事前生成戦略を設計済み
- Agent Swarmの活用は将来的な検討事項
- ベン（Claude）と協力してコード修正を進める予定

---

**次回セッション:** 明日以降（ユーザーが開始）

お疲れ様でした！明日も頑張りましょう 💪
