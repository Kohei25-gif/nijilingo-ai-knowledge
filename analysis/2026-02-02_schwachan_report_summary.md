# シュワちゃんレポート まとめ（ベニー向け）
**日付:** 2026-02-02
**作成:** ベン

---

## 📋 2つのレポートの概要

シュワちゃんに2つの調査を依頼した結果：

| レポート | 内容 | 発見した課題数 |
|----------|------|---------------|
| ①コード品質チェック | エラー、セキュリティ、iOS対応など | 66個 |
| ②多言語バグ修正 | 言語検出・逆翻訳の問題 | 2個（根本原因特定済み） |

---

# レポート①：コード品質チェック

## 🔴 今すぐやるべきこと（14個）

### エラー関連（4個）
| # | 問題 | 何が起きる？ | 直し方 |
|---|------|-------------|--------|
| 1 | JSONパースにtry-catchがない | AIの返事がおかしいとアプリがフリーズ | try-catchで囲む |
| 2 | awaitが抜けてる | 翻訳失敗しても気づかない | asyncとawaitを追加 |
| 3 | 画像アップロードのエラー処理がない | 画像が読めなくても何も出ない | onerrorを追加 |
| 4 | useEffectの依存配列がおかしい | 無限ループの可能性 | 依存を最小限に |

### セキュリティ（2個）
| # | 問題 | 何が起きる？ | 直し方 |
|---|------|-------------|--------|
| 5 | APIキーが見える可能性 | 悪用されるかも | サーバー経由にする |
| 6 | XSS攻撃の可能性 | 悪意あるスクリプト実行 | DOMPurifyで対策 |

### iOSアプリ化に必須（6個）
| # | 問題 | 何が起きる？ | 直し方 |
|---|------|-------------|--------|
| 7 | Capacitorが入ってない | Xcodeでビルドできない | npm install @capacitor/core |
| 8 | 音声認識がiOSで動かない | 対面モードが使えない | Capacitorプラグイン使う |
| 9 | コピー機能がiOSで動かない | 翻訳結果コピーできない | Capacitorプラグイン使う |
| 10 | localStorageの容量制限 | データが消える | Preferencesプラグイン使う |

### パフォーマンス（2個）
| # | 問題 | 何が起きる？ | 直し方 |
|---|------|-------------|--------|
| 11 | useStateが50個以上 | 画面がカクカク | useReducerにまとめる |
| 12 | API呼び出しが重複 | 無駄なAPI課金 | debounceで制御 |

---

## 🟡 近いうちにやること（20個）

### UX改善
- エラー時のリトライボタンがない
- ローディング表示が不十分
- 対面モードの言語切り替えがわかりにくい
- 相手一覧の検索機能がない

### iOS対応
- Service Workerがない（オフライン対応できない）
- console.logが多すぎ（本番で消すべき）
- キーボード表示時のレイアウト崩れ

### セキュリティ
- APIレスポンスの検証がない
- 入力文字数の制限がない
- タイムアウト処理がない

---

## 🟢 余裕がある時にやること（19個）

- ダークモード対応
- スプラッシュ画面のスキップ機能
- メッセージ履歴の日付グルーピング
- カスタムトーンのプリセット保存
- React.memoでパフォーマンス改善

---

## 📱 iOSアプリ化のロードマップ

| フェーズ | 内容 | 期間 |
|----------|------|------|
| 1 | Capacitor導入 | 1-2週間 |
| 2 | ネイティブ機能移行 | 2-3週間 |
| 3 | iOS最適化 | 1-2週間 |
| 4 | オフライン対応 | 2週間 |
| 5 | App Store申請準備 | 1週間 |

**合計: 8-10週間でApp Store公開可能**

---

# レポート②：多言語バグ修正

## 🐛 バグ1：言語検出がおかしい

### 何が起きてる？
フランス語「Pourriez-vous m'envoyer...」が「チェコ語」や「英語」と判定される

### なぜ？
```
"Pourriez-vous" の文字：
P, o, u, r, r, i, e, z... 全部普通のアルファベット！

→ é, è, ê みたいな「フランス語っぽい文字」がないと判定できない
```

### 解決策
**スコアリング方式を導入**

```
「ez-vous」が含まれてる → フランス語 +5点
「ción」が含まれてる → スペイン語 +4点
「sch」が含まれてる → ドイツ語 +3点
...

→ 一番点数が高い言語を採用！
```

---

## 🐛 バグ2：逆翻訳が英語のまま

### 何が起きてる？
フランス語→英語で翻訳すると、逆翻訳も英語になる
（本当はフランス語に戻るべき）

### なぜ？
コードが「日本語↔英語」専用で作られてた
```javascript
if (sourceLang !== '日本語') {
  // ← この中で「日本語」ってハードコードされてる
}
```

### 解決策
`sourceLang`（原文の言語）を使うように統一
```javascript
逆翻訳は ${sourceLang} で返す
```

---

## ✅ 日本語↔英語への影響

**影響なし！** 🎉

理由：
- 日本語↔英語は別のコードパスを通る
- 今回の修正は「他言語」のコードパスだけ
- 念のためコードパスを完全に分離

---

## 🔧 Claude Codeに投げるプロンプト

シュワちゃんが「Claude Code用完成版プロンプト」を作ってくれた。
以下の内容が含まれてる：

1. **修正するファイル**
   - `src/current/App.tsx` の `detectLanguage`関数
   - `src/current/groq.ts` の `getReverseTranslationInstruction`関数

2. **修正後のコード**（コピペ可能）

3. **テストケース**（30個）
   - 日本語↔英語保護テスト: 8個
   - 多言語バグ修正テスト: 10個
   - エッジケース: 12個

4. **注意事項**
   - 日本語↔英語は絶対に変更しない
   - 段階的にロールアウト

---

## 📝 次のアクション

### すぐやる
1. [ ] 多言語バグ修正（Claude Codeにプロンプト投げる）

### 今週中
2. [ ] JSONパースのtry-catch追加
3. [ ] awaitの追加
4. [ ] エラーハンドリング追加

### iOSアプリ化前
5. [ ] Capacitor導入
6. [ ] セキュリティ修正

---

## 📁 関連ファイル

| ファイル | 内容 |
|----------|------|
| `analysis/2026-02-02_schwachan_report_raw.md` | シュワちゃんレポート原文 |
| `analysis/2026-02-02_schwachan_report_summary.md` | このファイル（まとめ） |
| `src/current/App.tsx` | 現在のアプリコード |
| `src/current/groq.ts` | 現在の翻訳APIコード |
